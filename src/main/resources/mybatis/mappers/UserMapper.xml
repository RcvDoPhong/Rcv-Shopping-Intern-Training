<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shopping.intern.mapper.UserMapper">
    <sql id="Base_Column_List">
        mst_users.user_id, mst_users.user_name, mst_users.email, mst_users.password,
        mst_users.is_active, mst_users.is_delete, mst_users.group_id,
        mst_users.updated_by, mst_users.created_at, mst_users.updated_at
    </sql>
    <select id="findAll" resultType="User">
        SELECT <include refid="Base_Column_List" />, mst_groups.group_name as group_name, users.user_name as updated_by_user
        FROM mst_users
        INNER JOIN mst_groups ON mst_users.group_id = mst_groups.group_id
        LEFT JOIN mst_users AS users ON mst_users.updated_by = users.user_id
        WHERE mst_users.is_delete != 1
        <!-- <if test="userName != null">
            AND mst_users.user_name LIKE "%#{userName}%"
        </if>
        <if test="email != null">
            AND mst_users.email LIKE "%#{email}%"
        </if>
        <if test="groupId != 0">
            AND mst_users.group_id = #{groupId}
        </if>
        <if test="isActive != 0">
            AND mst_users.is_active = #{isActive}
        </if> -->
        <if test="paginate == true">
            LIMIT #{currentPage}, ${perPage}
        </if>
    </select>
    <select id="existByEmail" resultType="boolean">
        SELECT EXISTS (SELECT email FROM mst_users WHERE email=${email})
    </select>
    <insert id="insert">
        INSERT INTO
        mst_users(user_name, email, password, group_id, updated_by)
        VALUES (#{userName}, #{email}, #{password}, #{groupId}, #{updatedBy})
    </insert>
    <select id="findById" resultType="User">
        SELECT <include refid="Base_Column_List" />
        FROM mst_users WHERE user_id = #{userId}
    </select>
    <select id="findByEmail" resultType="User">
        SELECT <include refid="Base_Column_List" />
        FROM mst_users
        WHERE email=#{email}
        <if test="userId != 0">
            AND user_id != #{userId}
        </if>
    </select>
    <select id="findByName" resultType="User">
        SELECT <include refid="Base_Column_List" />
        FROM mst_users
        WHERE name=#{name}
    </select>
    <update id="update">
        UPDATE mst_users SET
        user_name=#{userName}, email=#{email}, group_id=#{groupId}, updated_by=#{updatedBy}
        WHERE user_id = #{userId}
    </update>
    <update id="lockById">
        UPDATE mst_users SET is_active=0 WHERE user_id = #{userId}
    </update>
    <update id="deleteById">
        UPDATE mst_users SET is_delete=1 WHERE user_id = #{user_id}
    </update>
</mapper>